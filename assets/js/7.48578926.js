(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{358:function(t,s,a){"use strict";a.r(s);var e=a(25),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"webapi基础"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webapi基础"}},[t._v("#")]),t._v(" WebAPI基础")]),t._v(" "),a("p",[a("code",[t._v("WebAPI")]),t._v("是一种用来开发系统间接口、设备接口"),a("code",[t._v("API")]),t._v("的技术,基于"),a("code",[t._v("Http")]),t._v("协议,请求和返回格式结果默认是"),a("code",[t._v("json")]),t._v("格式。比"),a("code",[t._v("WCF")]),t._v("更简单、更通用,比 "),a("code",[t._v("WebService")]),t._v("更节省流量、更简洁。")]),t._v(" "),a("p",[t._v("普通"),a("code",[t._v("ASP.Net MVC")]),t._v("甚至"),a("code",[t._v("HttpHandler")]),t._v("也可以开发"),a("code",[t._v("API")]),t._v(",但 "),a("code",[t._v("WebAPI")]),t._v("是更加专注于此的技术，更专业。")]),t._v(" "),a("p",[a("code",[t._v("Asp.Net WebAPI")]),t._v("和"),a("code",[t._v("Asp.Net MVC")]),t._v("有着非常密切的联系，"),a("code",[t._v("WebAPI")]),t._v("中可以复用"),a("code",[t._v("MVC")]),t._v("的路由、"),a("code",[t._v("ModelBinder")]),t._v("、"),a("code",[t._v("Filter")]),t._v(" 等知识,但是只是相仿, 类名、命名空间等一般都不一样,用法也有一些差别。")]),t._v(" "),a("p",[t._v("Asp.Net WebAPI 具有以下特点：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("Action")]),t._v("方法更专注于数据处理")]),t._v(" "),a("li",[t._v("更适合于"),a("code",[t._v("Restful")]),t._v("风格")]),t._v(" "),a("li",[t._v("不依赖于"),a("code",[t._v("Web服务器")]),t._v(",可以"),a("code",[t._v("selfhost")]),t._v(",或者寄宿于控制台或服务程序等")]),t._v(" "),a("li",[t._v("没有界面。"),a("code",[t._v("WebAPI")]),t._v("是接口开发技术,普通用户不会直接和"),a("code",[t._v("WebAPI")]),t._v("打交道")])]),t._v(" "),a("h2",{attrs:{id:"_1-restful"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-restful"}},[t._v("#")]),t._v(" 1. Restful")]),t._v(" "),a("p",[a("code",[t._v("Http")]),t._v("设计之初是有 "),a("strong",[t._v("“谓词语义”")]),t._v(" 的。这里谓词是指"),a("code",[t._v("HttpMethod")]),t._v(",常用的包括"),a("code",[t._v("Get")]),t._v("、"),a("code",[t._v("Post")]),t._v("、"),a("code",[t._v("Put")]),t._v("、"),a("code",[t._v("Delete")]),t._v(" 等。")]),t._v(" "),a("p",[t._v("通常情况下，使用"),a("code",[t._v("Get")]),t._v("获取数据，使用"),a("code",[t._v("Post")]),t._v("新增数据，使用"),a("code",[t._v("Put")]),t._v("修改数据，使用"),a("code",[t._v("Delete")]),t._v("删除数据。使用"),a("code",[t._v("Http")]),t._v("状态码表示处理结果。如 找不到资源使用"),a("code",[t._v("404")]),t._v("，没有权限使用"),a("code",[t._v("401")]),t._v("。此设计倾向于把所有业务操作抽象成对资源的CRUD操作。")]),t._v(" "),a("p",[t._v("如果"),a("code",[t._v("API")]),t._v("设计符合"),a("code",[t._v("Http")]),t._v("谓词语义规则，那么就可以称其符合"),a("code",[t._v("Restful")]),t._v("风格。Asp.Net WebAPI 设计之初就符合"),a("code",[t._v("Restful")]),t._v("风格。")]),t._v(" "),a("p",[a("code",[t._v("Restful")]),t._v("风格设计具有以下优势：")]),t._v(" "),a("ul",[a("li",[t._v("方便按类型操作做权限控制，如设置"),a("code",[t._v("Delete")]),t._v("权限只需处理"),a("code",[t._v("Delete")]),t._v("请求方式即可。")]),t._v(" "),a("li",[t._v("不需要复杂的"),a("code",[t._v("Action")]),t._v("方法名，转而根据"),a("code",[t._v("HttpMethod")]),t._v("匹配请求")]),t._v(" "),a("li",[t._v("充分利用"),a("code",[t._v("Http")]),t._v("状态码,不需要另做约定")]),t._v(" "),a("li",[t._v("浏览器可以自动缓存"),a("code",[t._v("Get")]),t._v("请求,有利于系统优化")])]),t._v(" "),a("p",[a("code",[t._v("Restful")]),t._v("风格设计同时也有许多弊端。仅通过谓词语义和参数匹配请求理论性太强，许多业务很难完全拆分为CRUD操作，如用户登录同时更新最后登录时间。另外，"),a("code",[t._v("Http")]),t._v("状态码有限，在很多业务场景中不足以表述处理结果，如“密码错误”和“AppKey错误”。")]),t._v(" "),a("p",[t._v("由于以上问题，导致"),a("code",[t._v("Restful")]),t._v("设计在很多业务场景中使用不便，很多大公司"),a("code",[t._v("API")]),t._v("也鲜少都能满足"),a("code",[t._v("Restful")]),t._v("规范。因此我们的原则是，尽可能遵守"),a("code",[t._v("Restful")]),t._v("规范，灵活变通，不追求极端。")]),t._v(" "),a("h2",{attrs:{id:"_2-webapi基础"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-webapi基础"}},[t._v("#")]),t._v(" 2. WebAPI基础")]),t._v(" "),a("h3",{attrs:{id:"_2-1-apicontroller"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-apicontroller"}},[t._v("#")]),t._v(" 2.1 ApiController")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("WebAPI中"),a("code",[t._v("Controller")]),t._v("直接即继承自"),a("code",[t._v("ControllerBase")]),t._v("。在ASP.NET Core 2.1之后引入"),a("code",[t._v("[ApiController]")]),t._v("用于批注 Web API 控制器类。"),a("code",[t._v("[ApiController]")]),t._v("特性通常结合"),a("code",[t._v("ControllerBase")]),t._v("来为控制器启用特定 REST 行为。")]),t._v(" "),a("div",{staticClass:"language-csharp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token attribute"}},[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Route")]),a("span",{pre:!0,attrs:{class:"token attribute-arguments"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api/[controller]"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token attribute"}},[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ApiController")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProductsController")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token type-list"}},[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ControllerBase")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])])]),t._v(" "),a("li",[a("p",[t._v("在 ASP.NET Core 2.2 或更高版本中，可将"),a("code",[t._v("[ApiController]")]),t._v("特性应用于程序集。以这种方式进行注释，会将 web API 行为应用到程序集中的所有控制器。 建议将程序集级别的特性应用于 Startup 类。")]),t._v(" "),a("div",{staticClass:"language-csharp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token attribute"}},[a("span",{pre:!0,attrs:{class:"token target keyword"}},[t._v("assembly")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ApiController")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("namespace")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("WebApiSample"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_22")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Startup")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])])])]),t._v(" "),a("h3",{attrs:{id:"_2-2-参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-参数"}},[t._v("#")]),t._v(" 2.2 参数")]),t._v(" "),a("p",[a("code",[t._v("GET")]),t._v("、"),a("code",[t._v("POST")]),t._v("、"),a("code",[t._v("PUT")]),t._v("、"),a("code",[t._v("DELETE")]),t._v("等所有请求方式均可使用 URL参数 和 对象参数 进行参数传递。")]),t._v(" "),a("p",[a("code",[t._v("GET")]),t._v("和"),a("code",[t._v("DELETE")]),t._v("请求通常传递数据量较少，多使用URL参数。"),a("code",[t._v("POST")]),t._v("和"),a("code",[t._v("PUT")]),t._v("请求通常传递数量较大，多使用对象参数。")]),t._v(" "),a("h4",{attrs:{id:"_2-2-1-url参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-url参数"}},[t._v("#")]),t._v(" 2.2.1 URL参数")]),t._v(" "),a("p",[t._v("简单参数有两种，QueryString参数和路由参数，这两种都参数以不同形式体现在URL中，所以我们统称为URL参数。")]),t._v(" "),a("p",[t._v("在参数少且简单对安全性要求不高的情况下，可以使用URL参数。")]),t._v(" "),a("div",{staticClass:"language-csharp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token attribute"}},[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Route")]),a("span",{pre:!0,attrs:{class:"token attribute-arguments"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api/test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestController")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token type-list"}},[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ControllerBase")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//GET api/test?name=colin&age=18")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("HttpGet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t._v("ActionResult"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")])]),t._v(" age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//DELETE api/test/1")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("HttpDelete")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{id}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t._v("ActionResult")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Delete")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")])]),t._v(" id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NoContent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br")])]),a("h4",{attrs:{id:"_2-2-2-对象参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-对象参数"}},[t._v("#")]),t._v(" 2.2.2 对象参数")]),t._v(" "),a("p",[t._v("参数内容多且复杂或安全性较高的情况下，在API中接收参数时我们常把参数字段封装到一个参数模型类中。"),a("strong",[t._v("使用非URL参数而不在服务端封装对象会遇到很多麻烦，不建议使用。")])]),t._v(" "),a("p",[t._v("客户端传递对象参数的方式有很多中，一般需要约定"),a("code",[t._v("Content-Type")]),t._v("报文头。服务端接收对象参数常使用"),a("code",[t._v("[FromXXX]")]),t._v("特性。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("特性")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("ContentType")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("传参方式")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("[FromQuery]")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("-")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("?name=colin&age=18")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("[FromHeader]")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("- 或 "),a("code",[t._v("application/x-www-form-urlencoded")]),t._v(" 或 "),a("code",[t._v("multipart/form-data")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("?name=colin&age=18")]),t._v(" 或 "),a("code",[t._v("key-value")]),t._v("对")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("[FromForm]")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("multipart/form-data")]),t._v(" 或 "),a("code",[t._v("application/x-www-form-urlencoded")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("name-value")]),t._v("对")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("[FromBody]")]),t._v(" 或 无标记")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("application/json")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("{name:'colin',age:18}")])])])])]),t._v(" "),a("div",{staticClass:"language-csharp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token attribute"}},[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Route")]),a("span",{pre:!0,attrs:{class:"token attribute-arguments"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api/test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestController")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token type-list"}},[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ControllerBase")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token attribute"}},[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpPost")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t._v("ActionResult")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Post")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token attribute"}},[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FromForm")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Person")]),t._v(" p"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("CreatedAtAction")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("nameof")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Post"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" p"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" p"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token attribute"}},[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpPut")]),a("span",{pre:!0,attrs:{class:"token attribute-arguments"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{id}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t._v("ActionResult")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")])]),t._v(" id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token attribute"}},[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FromBody")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Person")]),t._v(" p"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NoContent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/02/26/BK8ALvHeqthEYG5.png",alt:"POST请求表单参数"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/02/26/QwxlN83juSkFMWI.png",alt:"PUT请求JSON参数"}})]),t._v(" "),a("blockquote",[a("p",[t._v("JSON")])]),t._v(" "),a("p",[t._v("ContentType为applciation/json时，传递参数必须是"),a("a",{attrs:{href:"https://www.json.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("JSON格式"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("p",[t._v('按照JSON官网的规范（"A value can be a string in double quotes, or a number, or true or false or null, or an object or an array. These structures can be nested."），JSON可以直接传递字符串、数字和布尔三种简单类型。需要特别注意的是，字符串需要包裹在双引号直接('),a("strong",[t._v("双引号作为字符串的一部分")]),t._v(")。")]),t._v(" "),a("div",{staticClass:"language-csharp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token attribute"}},[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpPost")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token return-type class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Post")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token attribute"}},[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FromBody")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/02/26/ISQYUX3DcBlH7om.jpg",alt:"POST字符串"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/02/26/IbmZe26jgABL8yu.jpg",alt:"POST Ajax"}})]),t._v(" "),a("h3",{attrs:{id:"_2-3-返回值"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-返回值"}},[t._v("#")]),t._v(" 2.3 返回值")]),t._v(" "),a("p",[t._v("ASP.NET Core 提供以下 Web API 控制器操作返回类型选项：")]),t._v(" "),a("ul",[a("li",[t._v("特定类型")]),t._v(" "),a("li",[t._v("IActionResult")]),t._v(" "),a("li",[t._v("ActionResult<T>")])]),t._v(" "),a("p",[t._v("多数情况下返回数据时统一使用"),a("code",[t._v("ActionResult")]),t._v("<T>类型。"),a("code",[t._v("T")]),t._v("是实际属数据类型，在"),a("code",[t._v("Action")]),t._v("方法中编码时直接返回"),a("code",[t._v("T")]),t._v("类型数据即可。ASP.NET Core 自动将对象序列化为 JSON，并将 JSON 写入响应消息的正文中。")]),t._v(" "),a("p",[t._v("三种返回类型具体区别和使用参见"),a("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/aspnet/core/web-api/action-return-types?view=aspnetcore-2.2",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"_2-4-安全传输"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-安全传输"}},[t._v("#")]),t._v(" 2.4 安全传输")]),t._v(" "),a("ul",[a("li",[a("RouterLink",{attrs:{to:"/api/auth.html"}},[t._v("认证授权")]),t._v("。对API做认证授权，每次请求接口需要携带认证信息，如"),a("code",[t._v("JWT Token")])],1),t._v(" "),a("li",[t._v("请求重放。重复请求一个接口，如充值接口。要避免重复业务处理。每次请求的时候都带着当前时间(时间戳),服务器端比 较一下如果这个时间和当前时间相差超过一定时间,则失效。因此最多被重放一段时间, 这个要求客户端的时间和服务器端的时间要保持相差不大。有些业务场景下要使用一次性验证。")]),t._v(" "),a("li",[t._v("HTTPS。如果API暴露于外网建议使用HTTPS协议，可以增加被抓包难度。")])])])}),[],!1,null,null,null);s.default=n.exports}}]);